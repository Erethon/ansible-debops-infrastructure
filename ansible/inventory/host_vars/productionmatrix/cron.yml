---

cron__host_jobs:
  "purge_old_media":
    user: "root"
    jobs:
      - name: "Purge old Synapse media"
        job: "curl --header 'Authorization: Bearer {{ synapse__admin_auth_token }}' -X POST {{ ansible_host }}:8008/_synapse/admin/v1/purge_media_cache?before_ts=`date --date='-1 days' +\\%s\\%3N`"
    special_time: "daily"
  "cleanup_room_history":
    user: "root"
    jobs:
      - name: "Delete events for room 1"
        job: "curl --header 'Authorization: Bearer {{ synapse__admin_auth_token }}' -X POST -H 'Content-Type: application/json' {{ ansible_host }}:8008/_synapse/admin/v1/purge_history/{{ lookup('password', secret + '/credentials/productionmatrix/synapse/room_id_1') }} -d \"{\\\"delete_local_events\\\": true, \\\"purge_up_to_ts\\\": $(date --date='-10 days' +\\%s\\%3N)}\""
    special_time: "daily"
